generator client {
  provider = "prisma-client-js"
  output   = ".prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String?  // null for Google-only accounts
  googleId     String?  @unique

  emailVerified Boolean @default(false)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  datasets     Dataset[]
}


model Dataset {
  id           String          @id @default(cuid())
  ownerId      String
  owner        User            @relation(fields: [ownerId], references: [id])
  name         String
  originalName String
  mimeType     String
  sizeBytes    Int
  storagePath  String
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  jobs         ProcessingJob[]
}

model ProcessingJob {
  id           String     @id @default(cuid())
  datasetId    String
  dataset      Dataset    @relation(fields: [datasetId], references: [id])
  status       JobStatus  @default(PENDING)
  errorMessage String?
  resultKey    String?    // e.g. Redis key storing processed output
  createdAt    DateTime   @default(now())
  startedAt    DateTime?
  completedAt  DateTime?
}

enum JobStatus {
  PENDING
  RUNNING
  SUCCESS
  FAILED
}